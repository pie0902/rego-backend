services:
  app:
    image: ${DOCKERHUB_USERNAME}/ess:${IMAGE_TAG:-latest}
    container_name: ess-app
    restart: unless-stopped
    ports:
      - "8080:8080"
    environment:
      SPRING_PROFILES_ACTIVE: prod
      SPRING_DOCKER_COMPOSE_ENABLED: "false"
      SPRING_DATASOURCE_URL: ${SPRING_DATASOURCE_URL}
      DB_USERNAME: ${DB_USERNAME}
      DB_PASSWORD: ${DB_PASSWORD}
      JWT_SECRET: ${JWT_SECRET}
      JWT_EXPIRATION_MS: ${JWT_EXPIRATION_MS:-3600000}
      PROFILE_IMAGE_BASE_PATH: /data/profile-images
      FEATURE_DUMMY_DATA_ENABLED: "false"
    volumes:
      - profile-images:/data/profile-images

volumes:
  profile-images:



cat > /opt/ess/.env <<'EOF'
DOCKERHUB_USERNAME=thunder0902
SPRING_DATASOURCE_URL=jdbc:mysql://RDS-ENDPOINT:3306/ess?useSSL=false&allowPublicKeyRetrieval=true&serverTimezone=Asia/Seoul
DB_USERNAME=root
DB_PASSWORD=1234
JWT_SECRET=6lr37j7V1OG18lKLNVYCiq0cze9G5wq9oami1ViAfK0=
JWT_EXPIRATION_MS=3600000
EOF